<div class="change-password change-password-page">
  <div class="auth-content">
    <header class="auth-content__header">
      <p class="auth-content__badge">帳號安全</p>
      <h1 class="auth-content__title">設定密碼</h1>
      <p class="auth-content__subtitle">請設定您的登入密碼。</p>
    </header>

    @if (processing()) {
      <div class="message message--info">
        <i class="pi pi-spin pi-spinner"></i>
        <span>正在處理邀請連結...</span>
      </div>
    } @else if (tokenError()) {
      <div class="message message--error">
        <i class="pi pi-exclamation-circle"></i>
        <span>{{ tokenError() }}</span>
      </div>
      <div class="form__row" style="justify-content: center; margin-top: var(--space-4);">
        <a routerLink="/login" class="form__link">返回登入頁面</a>
      </div>
    } @else if (success()) {
      <div class="message message--success">
        <i class="pi pi-check-circle"></i>
        <span>密碼修改成功！即將跳回首頁...</span>
      </div>
    } @else {
      <form (ngSubmit)="onSubmit()" #passwordForm="ngForm" class="form">
        @if (error()) {
          <div class="message message--error">
            <i class="pi pi-exclamation-circle"></i>
            <span>{{ error() }}</span>
          </div>
        }

        <div class="form__field">
          <label class="form__label" for="newPassword">新密碼</label>
          <input
            type="password"
            id="newPassword"
            class="form__input"
            name="newPassword"
            [(ngModel)]="newPassword"
            placeholder="至少 6 位元組"
            required
            #newPassModel="ngModel"
          />
        </div>

        <div class="form__field">
          <label class="form__label" for="confirmPassword">確認新密碼</label>
          <input
            type="password"
            id="confirmPassword"
            class="form__input"
            name="confirmPassword"
            [(ngModel)]="confirmPassword"
            placeholder="請再次輸入新密碼"
            required
            #confirmPassModel="ngModel"
          />
        </div>

        <div class="form__row" style="justify-content: flex-end; gap: var(--space-3);">
          <button
            type="button"
            class="form__submit"
            style="background: var(--zinc-200); color: var(--zinc-700); width: auto; padding: var(--space-2) var(--space-6);"
            (click)="goBack()"
            [disabled]="submitting()"
          >
            取消
          </button>
          <button
            type="submit"
            class="form__submit"
            style="width: auto; padding: var(--space-2) var(--space-8);"
            [disabled]="submitting() || !passwordForm.valid"
          >
            @if (submitting()) {
              <i class="pi pi-spin pi-spinner"></i>
              處理中...
            } @else {
              確認修改
            }
          </button>
        </div>
      </form>
    }
  </div>
</div>

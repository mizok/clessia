# 家長資料

**路徑**: `/admin/parents`
**角色**: Admin
**分組**: 學務管理

## 核心目的

管理家長帳號，關聯學生。

## MVP 功能

### 家長列表

- 篩選：姓名/手機/Email 搜尋、有無關聯學生
- 每筆顯示：姓名、登入帳號（Email 或手機）、關聯學生數、帳號狀態
- 點擊進入編輯或查看詳情

### 新增/編輯家長 Popup

| 欄位 | 類型 | 必填 | 說明 |
|------|------|------|------|
| 姓名 | 文字 | 是 | |
| Email | 文字 | 二擇一 | 優先作為登入帳號 |
| 手機 | 文字 | 二擇一 | 無 Email 時作為登入帳號 |
| 關聯學生 | 多選 | 否 | 選擇要關聯的學生 |
| 帳號狀態 | 開關 | 是 | 啟用/停用 |
| 備註 | 長文字 | 否 | |

- Email 和手機至少填一個
- 系統自動判斷並顯示目前的登入帳號是 Email 或手機

### 關聯學生操作

- 在 Popup 中可搜尋並選擇學生
- 支援關聯多個學生（多個小孩）

### 帳號管理功能

| 功能 | 說明 |
|------|------|
| 重設密碼 | 產生新的隨機密碼，並產生新的帳號資訊卡 |
| 更換登入帳號 | 修改 Email 或手機，更換後自動重設密碼 |
| 產生帳號資訊卡 | 重新產生帳號資訊卡（含目前帳號和新密碼） |
| 停用帳號 | 暫停登入權限，資料保留 |
| 啟用帳號 | 恢復登入權限 |

### 驗證與登入設計

- 有 email 的家長：使用 email + 密碼登入
- 只有手機號碼的家長：使用手機號碼 + 密碼登入（後端 Better Auth `username` 欄位存手機號碼）
- 忘記密碼：有 email → 系統發送重設連結；沒有 email → 請聯絡管理者重設
- 帳號建立：由管理者後台手動建立，系統產生初始密碼，不需要 SMS OTP

## 資料依賴

| 操作 | 資料表 |
|------|--------|
| 讀取 | `parents`, `parent_student_relations`, `students` |
| 寫入 | `parents`, `parent_student_relations`, `ba_user` |

## PRD 參考

- 5.2 家長
- 7.5 管理員頁面

## 實作註記

- Email/手機唯一性檢查
- 所有帳號操作記錄於稽核紀錄

# Clessia 功能開發清單

> 依據 `PRD.md` 提取的功能模組清單，按依賴關係排序。
>
> **使用方式**：新 Session 開始時讀取此文件，找到下一個待開發功能。

---

## 依賴關係圖

```
┌─────────────────────────────────────────────────────────────────────┐
│                           基礎設定層                                  │
│  ┌─────────┐   ┌─────────┐   ┌──────────┐   ┌─────────┐              │
│  │ 分校 ✅ │   │ 課程 ✅ │   │ 人員管理 ✅│   │ 系統設定 │              │
│  └────┬────┘   └────┬────┘   └────┬────┘   └─────────┘              │
└───────┼─────────────┼─────────────┼─────────────────────────────────┘
        │             │             │
        ▼             ▼             ▼
┌───────┴─────────────┴─────────────┴─────────────────────────────────┐
│                           核心教學層                                  │
│  ┌──────────────────┐   ┌─────────────┐   ┌─────────────┐           │
│  │ 課程管理        │──▶│ 上課時間設定 │──▶│ 課堂產生     │           │
│  │（依賴：課程、分校）│   │（依賴：老師） │   │             │           │
│  └──────────────────┘   └─────────────┘   └──────┬──────┘           │
└─────────────────────────────────────────────────┼───────────────────┘
                                                  │
        ┌─────────────────────────────────────────┼───────────────────┐
        │                                         │                   │
        ▼                                         ▼                   ▼
┌───────────────────┐   ┌─────────────────────────────────────────────┐
│   學生管理層       │   │                 出勤/教學層                   │
│ ┌───────┐         │   │ ┌────────┐  ┌────────┐  ┌────────┐         │
│ │ 學生  │◀─┬──────┤   │ │ 出勤   │  │ 請假   │  │ 聯絡簿  │         │
│ └───┬───┘  │      │   │ └────────┘  └────────┘  └────────┘         │
│     │      │      │   │ ┌────────┐  ┌────────┐  ┌────────┐         │
│     ▼      │      │   │ │ 考試   │  │ 成績   │  │ 餐費    │         │
│ ┌───────┐  │      │   │ └────────┘  └────────┘  └────────┘         │
│ │ 家長  │  │      │   └─────────────────────────────────────────────┘
│ └───────┘  │      │
│            │      │
│ ┌──────────┴───┐  │
│ │ 學生報名      │◀─┘
│ │（依賴：開課班）│
│ └──────────────┘
└───────────────────┘
```

---

## ✅ 已完成

| #   | 功能                | 路徑              | 完成日期 |
| --- | ------------------- | ----------------- | -------- |
| 1   | 分校管理 (Campuses) | `/admin/campuses` | 2026-02  |
| 2   | 課程管理 (Courses)  | `/admin/courses`  | 2026-02  |
| 3   | 人員管理 (Staff)    | `/admin/staff`    | 2026-02  |

---

## 🔧 技術債（已知缺口，需獨立 branch 處理）

### 忘記密碼完整實作

**現況：** 前端流程已完成，但 email 實際上不會送出（無 SMTP 設定）。
**需要一起做（不建議分批）：**

- Resend 串接（免費 100 封/天，300+ 人後升級 Pro $20/月）
- per-email 冷卻時間（Cloudflare KV，15 分鐘只能發一封）
- Turnstile 伺服器驗證（token 有收但未驗證）
- Better Auth `sendResetPassword` hook

**暫時替代方案：** 使用者忘記密碼時，聯絡管理者從後台重設。

### 手機號碼登入（延後至家長介面開發時）

**現況：** 登入頁目前只支援 email。
**實作方式：** 自訂 Hono endpoint `POST /api/auth/sign-in/phone`，查 `ba_user.phone` 反查帳號再登入。
**依賴：** 建議等家長介面（Phase 9）開發時一起做。

---

## 📋 待開發（依開發順序）

### Phase 1: 基礎設定（補齊）

_Phase 1 已全部完成。_

### Phase 2: 核心教學架構

| #   | 功能         | 路徑             | 依賴         | 說明                               |
| --- | ------------ | ---------------- | ------------ | ---------------------------------- |
| 4   | 課程管理     | `/admin/classes` | 課程、分校   | 建立開課班、設定人數上限、升班路徑 |
| 5   | 上課時間設定 | 同上頁面         | 開課班、老師 | 每週固定時段、指定任課老師         |
| 6   | 課堂產生     | 同上頁面         | 上課時間     | 批次產生指定日期範圍的課堂         |

### Phase 3: 學生管理

| #   | 功能     | 路徑                | 依賴         | 說明                       |
| --- | -------- | ------------------- | ------------ | -------------------------- |
| 7   | 學生管理 | `/admin/students`   | 無           | CRUD、年級、學校           |
| 8   | 家長管理 | `/admin/parents`    | 學生         | CRUD、關聯學生、帳號資訊卡 |
| 9   | 學生報名 | `/admin/enrollment` | 學生、開課班 | 直接報名（跳過申請流程）   |

### Phase 4: 出勤系統

| #   | 功能     | 路徑                | 依賴       | 說明                   |
| --- | -------- | ------------------- | ---------- | ---------------------- |
| 10  | 掃碼到班 | `/check-in`         | 學生、分校 | 公開頁面、QR Code 掃描 |
| 11  | 出勤管理 | `/admin/attendance` | 課堂、報名 | 查看/修正出勤狀態      |
| 12  | 請假管理 | `/admin/leave`      | 課堂、學生 | 建立/查詢請假紀錄      |

### Phase 5: 教學紀錄

| #   | 功能     | 路徑                   | 依賴         | 說明                   |
| --- | -------- | ---------------------- | ------------ | ---------------------- |
| 13  | 課程日曆 | `/admin/calendar`      | 課堂         | 日曆顯示所有課堂       |
| 14  | 聯絡簿   | 課堂詳情內             | 課堂         | 公版內容 + 個人化標籤  |
| 15  | 考試管理 | `/teacher/assessments` | 課程、開課班 | 建立考試、設定參加範圍 |
| 16  | 成績管理 | 同上 + `/admin/grades` | 考試、學生   | 輸入/匯入成績          |
| 17  | 餐費管理 | `/admin/meals`         | 學生         | 新增/查詢餐費紀錄      |

### Phase 6: 公開端報名流程

| #   | 功能         | 路徑                         | 依賴     | 說明               |
| --- | ------------ | ---------------------------- | -------- | ------------------ |
| 18  | 試聽申請表單 | `/trial`                     | 課程     | 公開頁面、無需登入 |
| 19  | 報名申請表單 | `/apply`                     | 開課班   | 公開頁面、無需登入 |
| 20  | 試聽管理     | `/admin/trials`              | 試聽申請 | 安排試聽、跟進結果 |
| 21  | 報名審核     | `/admin/enrollment-requests` | 報名申請 | 審核通過/拒絕      |

### Phase 7: 繳費系統

| #   | 功能         | 路徑                   | 依賴               | 說明               |
| --- | ------------ | ---------------------- | ------------------ | ------------------ |
| 22  | 費用方案管理 | `/admin/fee-templates` | 開課班             | 月繳/期繳方案設定  |
| 23  | 繳費單管理   | `/admin/payments`      | 報名申請、費用方案 | 建立/管理繳費單    |
| 24  | 繳費確認     | 同上                   | 繳費單             | 確認收款、建立報名 |

### Phase 8: 進階管理

| #   | 功能       | 路徑                  | 依賴         | 說明                 |
| --- | ---------- | --------------------- | ------------ | -------------------- |
| 25  | 課務異動   | `/admin/changes`      | 課堂         | 調課/代課/停課       |
| 26  | 待處理工作 | `/admin/tasks`        | 各種業務     | 任務認領、處理、轉派 |
| 27  | 通知中心   | 各端 `/notifications` | 各種事件     | 站內通知、推播       |
| 28  | 續課管理   | `/admin/renewals`     | 報名、繳費單 | 預告制自動續課       |
| 29  | 系統設定   | `/admin/settings`     | 無           | 全域設定             |

### Phase 9: 家長端

| #   | 功能     | 路徑                 | 依賴       | 說明               |
| --- | -------- | -------------------- | ---------- | ------------------ |
| 30  | 家長首頁 | `/parent/dashboard`  | 課堂、出勤 | 今日概覽、推薦課程 |
| 31  | 課表查看 | `/parent/schedule`   | 課堂       | 週曆/單日視圖      |
| 32  | 到班紀錄 | `/parent/attendance` | 出勤       | 日期列表           |
| 33  | 成績查閱 | `/parent/grades`     | 成績       | 按課程分組         |
| 34  | 餐費紀錄 | `/parent/meals`      | 餐費       | 按月份分組         |
| 35  | 繳費紀錄 | `/parent/payments`   | 繳費單     | 待繳/已繳          |
| 36  | 續課資訊 | `/parent/renewal`    | 續課       | 預覽、異動申請     |
| 37  | 加選課程 | `/parent/add-course` | 開課班     | 瀏覽、加選申請     |

### Phase 10: 老師端

| #   | 功能       | 路徑                   | 依賴   | 說明               |
| --- | ---------- | ---------------------- | ------ | ------------------ |
| 38  | 我的課表   | `/teacher/calendar`    | 課堂   | 月曆 + 列表視圖    |
| 39  | 聯絡簿編輯 | 課堂詳情內             | 聯絡簿 | Markdown 編輯器    |
| 40  | 考試管理   | `/teacher/assessments` | 考試   | 建立考試、輸入成績 |

---

## 新 Session 開發 Prompt 模板

開始新 Session 時複製使用：

```
請開始開發「[功能名稱]」功能。

規格：doc/specs/[角色]/[分類]/[功能].md
路徑：[路由]
依賴：[已完成的依賴功能]

請遵循 doc/AGENT_GUIDE.md 流程：
1. Phase 0：環境調查
2. Phase 1：讀取規格檔（spec 已存在，不需另寫）
3. Phase 2-6：依序實作並驗證

Phase 2-4 優先委派 Codex。
```

### Spec 檔案路徑對照

| 功能     | Spec 路徑                                  |
| -------- | ------------------------------------------ |
| 人員管理 | `doc/specs/admin/system/staff.md`          |
| 課程管理 | `doc/specs/admin/academic/classes.md`      |
| 學生管理 | `doc/specs/admin/academic/students.md`     |
| 家長管理 | `doc/specs/admin/academic/parents.md`      |
| 出勤管理 | `doc/specs/admin/attendance/attendance.md` |

> 完整 spec 檔案列表請執行：`find doc/specs -name "*.md" | sort`

### 範例：下一個功能

```
請開始開發「人員管理」功能。

規格：doc/specs/admin/system/staff.md
路徑：/admin/staff
依賴：分校（已完成）

請遵循 doc/AGENT_GUIDE.md 流程。Phase 2-4 優先委派 Codex。
```

---

## 開發建議

### 最小可用版本 (MVP) 優先順序

若要快速上線，建議優先完成以下功能：

1. **Phase 1-3**：基礎管理 + 學生報名 → 可以開始招生
2. **Phase 4**：出勤系統 → 可以開始點名
3. **Phase 9（部分）**：家長首頁 + 課表 → 家長可查看

### Codex 適合委派的功能

以下功能規格明確，適合優先委派 Codex：

- 學生管理 CRUD
- 家長管理 CRUD
- 餐費管理 CRUD
- 系統設定 CRUD
- 各類列表頁的 API 層

### Claude 專屬功能

以下功能需要 UI/UX 判斷，由 Claude 處理：

- 課程日曆（複雜 UI）
- 聯絡簿編輯器（Markdown + 學生列表）
- 家長首頁（多區塊整合）
- 成績輸入介面（表格 + 批次操作）

---

## 更新紀錄

| 日期       | 更新內容                                                     |
| ---------- | ------------------------------------------------------------ |
| 2026-02-15 | 初始建立，從 PRD.md 提取功能清單                             |
| 2026-02-22 | 標記人員管理已完成；新增技術債區段（忘記密碼、手機號碼登入） |
